{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "schemas.json",
  "definitions": {
    "ShellLoadRequest": {
      "$id": "schema.ShellLoadRequest",
      "type": "object",
      "required": ["user"],
      "properties": {
        "user": {
          "type": "object",
          "required": ["id", "role"],
          "properties": {
            "id": { "type": "string" },
            "role": { "type": "string", "enum": ["operator", "observer", "admin"] },
            "team": { "type": "string" }
          }
        },
        "runId": { "type": "string" },
        "focusPanel": { "type": "string", "enum": ["workflow", "config", "codex"] }
      }
    },
    "ShellLoadResponse": {
      "$id": "schema.ShellLoadResponse",
      "type": "object",
      "required": ["activePanels", "nav"],
      "properties": {
        "activePanels": { "type": "integer", "minimum": 1 },
        "nav": {
          "type": "object",
          "required": ["items"],
          "properties": {
            "items": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["id", "label"],
                "properties": {
                  "id": { "type": "string" },
                  "label": { "type": "string" },
                  "badge": { "type": "string" }
                }
              }
            }
          }
        }
      }
    },
    "UIEvent": {
      "$id": "schema.UIEvent",
      "type": "object",
      "required": ["source", "type", "payload"],
      "properties": {
        "source": { "type": "string", "enum": ["workflow", "configurator", "codex"] },
        "type": { "type": "string" },
        "payload": { "type": "object" },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "UIRouteAck": {
      "$id": "schema.UIRouteAck",
      "type": "object",
      "required": ["accepted"],
      "properties": {
        "accepted": { "type": "boolean" },
        "forwarded_to": { "type": "string" },
        "reason": { "type": "string" }
      }
    },
    "WorkflowSnapshot": {
      "$id": "schema.WorkflowSnapshot",
      "type": "object",
      "required": ["runId", "generatedAt", "stages"],
      "properties": {
        "runId": { "type": "string" },
        "generatedAt": { "type": "string", "format": "date-time" },
        "summary": { "type": "string" },
        "stages": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["id", "name", "status"],
            "properties": {
              "id": { "type": "string" },
              "name": { "type": "string" },
              "status": { "type": "string", "enum": ["pending", "ready", "running", "blocked", "error", "done"] },
              "dependsOn": {
                "type": "array",
                "items": { "type": "string" }
              },
              "artifacts": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": ["name", "kind", "state"],
                  "properties": {
                    "name": { "type": "string" },
                    "kind": { "type": "string" },
                    "state": { "type": "string", "enum": ["pending", "ready", "published", "failed"] },
                    "uri": { "type": "string" },
                    "owner": { "type": "string" }
                  }
                }
              },
              "etaSeconds": { "type": "number" }
            }
          }
        }
      }
    },
    "RenderResult": {
      "$id": "schema.RenderResult",
      "type": "object",
      "required": ["sections", "lastUpdated"],
      "properties": {
        "sections": { "type": "integer", "minimum": 1 },
        "lastUpdated": { "type": "string", "format": "date-time" },
        "warnings": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "StageDrilldownRequest": {
      "$id": "schema.StageDrilldownRequest",
      "type": "object",
      "required": ["runId", "stageId"],
      "properties": {
        "runId": { "type": "string" },
        "stageId": { "type": "string" }
      }
    },
    "StageDrilldownView": {
      "$id": "schema.StageDrilldownView",
      "type": "object",
      "required": ["stageId", "artifacts"],
      "properties": {
        "stageId": { "type": "string" },
        "artifacts": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "state"],
            "properties": {
              "name": { "type": "string" },
              "state": { "type": "string" },
              "uri": { "type": "string" },
              "size": { "type": "number" }
            }
          }
        },
        "notes": { "type": "string" }
      }
    },
    "ArtifactRef": {
      "$id": "schema.ArtifactRef",
      "type": "object",
      "required": ["runId", "stageId", "artifactId"],
      "properties": {
        "runId": { "type": "string" },
        "stageId": { "type": "string" },
        "artifactId": { "type": "string" }
      }
    },
    "ArtifactView": {
      "$id": "schema.ArtifactView",
      "type": "object",
      "required": ["ref", "state"],
      "properties": {
        "ref": { "$ref": "schema.ArtifactRef" },
        "state": { "type": "string", "enum": ["pending", "ready", "published", "failed"] },
        "uri": { "type": "string" },
        "owner": { "type": "string" },
        "size": { "type": "number" },
        "checksum": { "type": "string" }
      }
    },
    "ConfigTemplate": {
      "$id": "schema.ConfigTemplate",
      "type": "object",
      "required": ["version", "defaults", "limits"],
      "properties": {
        "version": { "type": "string" },
        "defaults": {
          "type": "object",
          "properties": {
            "variantCount": { "type": "integer", "minimum": 1 },
            "briefDepth": { "type": "integer", "minimum": 1 },
            "followUpPolicy": { "type": "string", "enum": ["auto", "manual", "disabled"] },
            "reviewerBots": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "limits": {
          "type": "object",
          "properties": {
            "variantCount": {
              "type": "object",
              "required": ["min", "max"],
              "properties": {
                "min": { "type": "integer", "minimum": 1 },
                "max": { "type": "integer", "minimum": 1 }
              }
            },
            "briefDepth": {
              "type": "object",
              "required": ["min", "max"],
              "properties": {
                "min": { "type": "integer", "minimum": 1 },
                "max": { "type": "integer", "minimum": 1 }
              }
            }
          }
        }
      }
    },
    "ConfigFormState": {
      "$id": "schema.ConfigFormState",
      "type": "object",
      "required": ["fields"],
      "properties": {
        "fields": {
          "type": "object",
          "properties": {
            "variantCount": {
              "type": "object",
              "required": ["default", "min", "max"],
              "properties": {
                "default": { "type": "integer" },
                "min": { "type": "integer" },
                "max": { "type": "integer" }
              }
            },
            "briefDepth": {
              "type": "object",
              "required": ["default", "min", "max"],
              "properties": {
                "default": { "type": "integer" },
                "min": { "type": "integer" },
                "max": { "type": "integer" }
              }
            },
            "followUpPolicy": {
              "type": "object",
              "required": ["default", "options"],
              "properties": {
                "default": { "type": "string" },
                "options": {
                  "type": "array",
                  "items": { "type": "string" }
                }
              }
            },
            "reviewerBots": {
              "type": "object",
              "required": ["available"],
              "properties": {
                "available": {
                  "type": "array",
                  "items": { "type": "string" }
                }
              }
            }
          }
        }
      }
    },
    "ConfigSubmission": {
      "$id": "schema.ConfigSubmission",
      "type": "object",
      "required": ["variantCount", "briefDepth", "followUpPolicy", "reviewerBots", "createdBy"],
      "properties": {
        "variantCount": { "type": "integer", "minimum": 1 },
        "briefDepth": { "type": "integer", "minimum": 1 },
        "followUpPolicy": { "type": "string" },
        "reviewerBots": {
          "type": "array",
          "items": { "type": "string" }
        },
        "createdBy": { "type": "string" },
        "notes": { "type": "string" }
      }
    },
    "ConfigSubmissionResult": {
      "$id": "schema.ConfigSubmissionResult",
      "type": "object",
      "required": ["valid", "errors"],
      "properties": {
        "valid": { "type": "boolean" },
        "manifestRef": { "type": "string" },
        "preview": { "$ref": "schema.RunManifest" },
        "errors": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "CodexPrompt": {
      "$id": "schema.CodexPrompt",
      "type": "object",
      "required": ["intent", "channel", "context"],
      "properties": {
        "intent": { "type": "string", "enum": ["draft_brief", "draft_requirement", "draft_note"] },
        "channel": { "type": "string" },
        "context": {
          "type": "object",
          "properties": {
            "text": { "type": "string" },
            "tokens": { "type": "integer", "minimum": 0 }
          }
        },
        "draft": { "type": "string" }
      }
    },
    "CodexSuggestion": {
      "$id": "schema.CodexSuggestion",
      "type": "object",
      "required": ["id", "content", "metadata"],
      "properties": {
        "id": { "type": "string" },
        "content": { "type": "string" },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
        "metadata": {
          "type": "object",
          "required": ["policyChecked"],
          "properties": {
            "policyChecked": { "type": "boolean" },
            "source": { "type": "string" }
          }
        },
        "warnings": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "CodexSuggestionStream": {
      "$id": "schema.CodexSuggestionStream",
      "type": "object",
      "required": ["suggestions"],
      "properties": {
        "suggestions": {
          "type": "array",
          "items": { "$ref": "schema.CodexSuggestion" }
        },
        "latencyMs": { "type": "integer", "minimum": 0 }
      }
    },
    "CodexDraft": {
      "$id": "schema.CodexDraft",
      "type": "object",
      "required": ["channel", "content", "author"],
      "properties": {
        "channel": { "type": "string" },
        "content": { "type": "string" },
        "author": { "type": "string" },
        "linkedPromptId": { "type": "string" }
      }
    },
    "DraftPublishAck": {
      "$id": "schema.DraftPublishAck",
      "type": "object",
      "required": ["persisted"],
      "properties": {
        "persisted": { "type": "boolean" },
        "uri": { "type": "string" },
        "warnings": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "RunIdentifier": {
      "$id": "schema.RunIdentifier",
      "type": "object",
      "required": ["runId", "actor"],
      "properties": {
        "runId": { "type": "string" },
        "actor": {
          "type": "object",
          "required": ["userId", "canView"],
          "properties": {
            "userId": { "type": "string" },
            "canView": { "type": "boolean" }
          }
        }
      }
    },
    "SessionContext": {
      "$id": "schema.SessionContext",
      "type": "object",
      "required": ["userId", "roles"],
      "properties": {
        "userId": { "type": "string" },
        "roles": {
          "type": "array",
          "items": { "type": "string" }
        },
        "team": { "type": "string" },
        "permissions": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "WorkflowSnapshotStream": {
      "$id": "schema.WorkflowSnapshotStream",
      "type": "object",
      "required": ["interval_seconds", "initial"],
      "properties": {
        "interval_seconds": { "type": "number", "minimum": 0 },
        "initial": { "$ref": "schema.WorkflowSnapshot" },
        "updates": {
          "type": "array",
          "items": { "$ref": "schema.WorkflowSnapshot" }
        }
      }
    },
    "RunManifest": {
      "$id": "schema.RunManifest",
      "type": "object",
      "required": ["runId", "parameters", "createdBy", "version", "readyForLaunch"],
      "properties": {
        "runId": { "type": "string" },
        "parameters": {
          "type": "object",
          "required": ["variantCount", "briefDepth", "followUpPolicy", "reviewerBots"],
          "properties": {
            "variantCount": { "type": "integer", "minimum": 1 },
            "briefDepth": { "type": "integer", "minimum": 1 },
            "followUpPolicy": { "type": "string" },
            "reviewerBots": {
              "type": "array",
              "items": { "type": "string" }
            },
            "briefTemplates": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "createdBy": { "type": "string" },
        "version": { "type": "string" },
        "readyForLaunch": { "type": "boolean" },
        "notes": { "type": "string" }
      }
    },
    "PersistResult": {
      "$id": "schema.PersistResult",
      "type": "object",
      "required": ["saved"],
      "properties": {
        "saved": { "type": "boolean" },
        "version": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "RunHistoryRecord": {
      "$id": "schema.RunHistoryRecord",
      "type": "object",
      "required": ["runId", "manifest", "status"],
      "properties": {
        "runId": { "type": "string" },
        "manifest": { "$ref": "schema.RunManifest" },
        "status": { "type": "string", "enum": ["draft", "running", "complete", "failed"] },
        "startedAt": { "type": "string", "format": "date-time" },
        "completedAt": { "type": "string", "format": "date-time" },
        "summaryUri": { "type": "string" }
      }
    },
    "HistoryReceipt": {
      "$id": "schema.HistoryReceipt",
      "type": "object",
      "required": ["saved"],
      "properties": {
        "saved": { "type": "boolean" },
        "version": { "type": "string" },
        "location": { "type": "string" }
      }
    },
    "HistoryQuery": {
      "$id": "schema.HistoryQuery",
      "type": "object",
      "required": ["userId"],
      "properties": {
        "userId": { "type": "string" },
        "limit": { "type": "integer", "minimum": 1 },
        "team": { "type": "string" }
      }
    },
    "HistorySummary": {
      "$id": "schema.HistorySummary",
      "type": "object",
      "required": ["runId", "status", "startedAt"],
      "properties": {
        "runId": { "type": "string" },
        "status": { "type": "string" },
        "startedAt": { "type": "string", "format": "date-time" },
        "completedAt": { "type": "string", "format": "date-time" },
        "parameters": { "$ref": "schema.RunManifest" }
      }
    },
    "HistoryList": {
      "$id": "schema.HistoryList",
      "type": "object",
      "required": ["items"],
      "properties": {
        "items": {
          "type": "array",
          "items": { "$ref": "schema.HistorySummary" }
        }
      }
    },
    "HistoryView": {
      "$id": "schema.HistoryView",
      "type": "object",
      "required": ["entries", "replayMode"],
      "properties": {
        "entries": {
          "type": "array",
          "items": { "$ref": "schema.HistorySummary" }
        },
        "selectedRunId": { "type": "string" },
        "replayMode": { "type": "string", "enum": ["off", "replay"] }
      }
    },
    "HistoryReplayRequest": {
      "$id": "schema.HistoryReplayRequest",
      "type": "object",
      "required": ["runId", "mode"],
      "properties": {
        "runId": { "type": "string" },
        "mode": { "type": "string", "enum": ["replay", "export"] },
        "operatorId": { "type": "string" }
      }
    },
    "ReplayAck": {
      "$id": "schema.ReplayAck",
      "type": "object",
      "required": ["runId", "started"],
      "properties": {
        "runId": { "type": "string" },
        "started": { "type": "boolean" },
        "mode": { "type": "string", "enum": ["replay", "export"] }
      }
    },
    "ValidationIssue": {
      "$id": "schema.ValidationIssue",
      "type": "object",
      "required": ["code", "message"],
      "properties": {
        "code": { "type": "string" },
        "message": { "type": "string" },
        "field": { "type": "string" }
      }
    },
    "ValidationReport": {
      "$id": "schema.ValidationReport",
      "type": "object",
      "required": ["status", "issues"],
      "properties": {
        "status": { "type": "string", "enum": ["ok", "error"] },
        "issues": {
          "type": "array",
          "items": { "$ref": "schema.ValidationIssue" }
        }
      }
    },
    "KickoffReceipt": {
      "$id": "schema.KickoffReceipt",
      "type": "object",
      "required": ["runId", "startedAt"],
      "properties": {
        "runId": { "type": "string" },
        "startedAt": { "type": "string", "format": "date-time" },
        "cliPid": { "type": "integer" },
        "logsUri": { "type": "string" }
      }
    }
  }
}
