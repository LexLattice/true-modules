{
  "summary": "Added an events summary command that materializes JSON/markdown dashboards and wired a main-branch workflow to mine lessons automatically.",
  "checklist": [
    {
      "id": "P1",
      "status": "implemented",
      "notes": "Introduced tm events summary plus automation to publish summary artifacts and lessons.json."
    }
  ],
  "architecture": {
    "components_added": [],
    "components_modified": [],
    "data_flow": "tm events summary reads NDJSON telemetry, writes deterministic artifacts/summary.* files, and the lessons workflow reruns gates before mining lessons.json for downstream prompts.",
    "state_management": "Event aggregates persist as summary.json/summary.md while lessons-auto.sh rewrites lessons.json in the repo root; no long-lived in-memory state added.",
    "invariants": [
      "events summary always writes artifacts/summary.json and artifacts/summary.md for the provided NDJSON",
      "lessons-auto.sh exits cleanly when no lesson changes are detected"
    ],
    "tradeoffs": [
      "Re-running shipping gates in lessons.yml increases CI time but guarantees fresh events for summaries."
    ],
    "alternatives_considered": [
      {
        "option": "Reuse artifacts from the ci workflow",
        "rejected_because": "Cross-workflow artifact sharing would require extra API plumbing and secrets."
      }
    ],
    "open_questions": [
      "Should we enable commit mode in lessons-auto.sh once the bot account is ready?"
    ]
  },
  "tests": {
    "added": [],
    "how_to_run": "node tm.mjs events summary --in runs/2025-10-13-demo-headless/artifacts/events.ndjson --top 3"
  },
  "metrics": {
    "files_changed": 6,
    "insertions": 568,
    "deletions": 0
  },
  "decisions": [
    {
      "option": "Publish lessons.json as an artifact instead of committing",
      "rationale": "Keeps the workflow read-only until automated commit credentials are provisioned.",
      "rejected_alternatives": [
        {
          "variant": "Auto-commit lessons.json on every main push",
          "reason": "Requires git credentials in CI and could create merge churn without governance.",
          "confidence": 0.6
        }
      ]
    }
  ],
  "risks": [
    "Gates execution inside lessons.yml could fail, blocking artifact publication."
  ],
  "residual_risks": [
    "If gates flake the workflow will not upload fresh summaries despite existing lessons data."
  ],
  "followups": [
    {
      "title": "Enable commit mode once bot credentials exist",
      "priority": "P2",
      "owner": "platform",
      "pointer": "scripts/lessons-auto.sh#L1"
    }
  ],
  "todos": [
    "Add unit coverage for summarizeEvents to guard against schema changes."
  ],
  "confidence": 0.6
}
